# 铁路 12306 复刻项目 — 需求场景与需求树

- 版本：v1.0
- 日期：2025-11-15

## 1. 业务场景总览

- S1 用户注册与登录
- S2 常用乘车人管理（查看/新增/删除）
- S3 车票查询（单程）
- S4 车次筛选（类型/席别）与条件修改
- S5 订单创建（预订/提交）
- S6 订单支付（模拟）与订单列表查看
- S7 个人信息查看与联系方式编辑

## 2. 场景详述

### S1 用户注册与登录

- 参与者：未注册用户、已注册用户
- 前置条件：用户名 `new user` 未被注册；系统可用
- 主成功场景：
  1. 用户在首页点击“注册”进入注册页
  2. 输入：用户名 `new user`、密码与确认 `mypassword`、姓名 `New User`、证件号 `100111222233334443`、手机号 `13812341234`
  3. 勾选协议并提交，提示“注册成功”，跳转首页
  4. 用户点击“登录”，选择“账号登录”
  5. 输入用户名 `new user` 与密码 `mypassword`，点击“立即登录”
  6. 登录成功，首页顶部显示“您好, New User”
- 备选/异常流：
  - 用户名已存在 → 阻止注册并提示
  - 密码不符合策略/不一致 → 阻止注册并提示
  - 登录凭证错误 → 提示“用户名或密码错误”
- 后置条件：账户已创建；默认乘客已关联；会话有效
- 验收点：完成注册与登录，页面显示问候语

### S2 常用乘车人管理

- 参与者：已登录用户
- 前置条件：用户已登录
- 主成功场景（查看/新增/删除）：
  1. 进入“个人中心” → “常用信息管理/乘车人”，列表显示默认乘客
  2. 点击“添加”弹窗，新增乘客“张三”，身份证 `100111222233334444`，手机号 `13812341235`，优惠类型“成人”，保存后出现在列表
  3. 再次“添加”，新增乘客“李四”，身份证 `100111222233334445`，手机号 `13812341236`，优惠类型“成人”，保存后出现在列表
  4. 在列表对“张三”点击“删除”，确认后移除
- 备选/异常流：
  - 证件号重复 → 阻止保存并提示
  - 手机号/证件号格式错误 → 阻止保存并提示
  - 删除受限（存在未出行订单）→ 阻止删除并提示（可选约束）
- 后置条件：列表包含默认乘客与“李四”；“张三”已删除
- 验收点：列表正确增删与展示

### S3 车票查询（单程）

- 参与者：已登录用户
- 前置条件：数据库已预置 2025-12-15/16 的车次数据；城市-车站映射有效
- 主成功场景：
  1. 首页选择“单程”
  2. 输入出发地“北京”、到达地“上海”、出发日期“2025-12-15”
  3. 点击“查询”，跳转“车次列表”并展示符合条件车次
- 备选/异常流：
  - 日期非法/无车次 → 友好提示与空结果展示
- 后置条件：列表页按条件加载
- 验收点：北京→上海的结果展示（含 G/D/K 的相关车次）

### S4 车次筛选与条件修改

- 参与者：已登录用户
- 前置条件：已在车次列表页
- 主成功场景：
  1. 在“车次类型”仅勾选“D-动车”，列表刷新仅显示 D 开头车次
  2. 在“车次席别”仅勾选“一等座”，列表刷新仅显示包含一等座的车次
  3. 修改查询条件为出发地“南京”、目的地“上海”，点击“查询”，页面刷新为南京→上海的车次
- 备选/异常流：
  - 无匹配车次 → 空状态与提示
- 后置条件：筛选与条件修改即时生效
- 验收点：筛选与查询结果一致性

### S5 订单创建（预订与提交）

- 参与者：已登录用户
- 前置条件：车次列表已加载；乘客存在
- 主成功场景：
  1. 在列表页选择第一个车次，点击“预订”，跳转订单填写页，展示列车与乘客信息
  2. 在乘客信息勾选“New User”，为其选择席别“二等座”
  3. 点击“提交订单”，系统创建订单并跳转订单详情，状态为“待支付”
- 备选/异常流：
  - 席别不支持/参数缺失 → 阻止提交并提示
  - 重复提交（短时间同车次同乘客）→ 幂等返回同一订单（建议）
- 后置条件：产生“待支付”订单
- 验收点：订单详情展示与状态“待支付”

### S6 订单支付（模拟）与订单列表

- 参与者：已登录用户
- 前置条件：存在“待支付”订单
- 主成功场景：
  1. 进入“订单中心/火车票订单/未完成订单”，看到待支付列表
  2. 点击第一个订单“去支付”，弹出模拟支付成功提示
  3. 确认并返回列表，订单状态更新为“已支付”
  4. 切换至“未出行订单”，可见已支付订单
- 备选/异常流：
  - 非待支付订单发起支付 → 阻止并提示
  - 重复支付 → 保持幂等返回已支付状态
- 后置条件：订单状态流转为“已支付”
- 验收点：列表状态一致性与支付提示流程

### S7 个人信息查看与联系方式编辑

- 参与者：已登录用户
- 前置条件：用户资料存在
- 主成功场景：
  1. 进入“个人中心/个人信息/查看个人信息”，显示基本信息与联系方式
  2. 在“联系方式”模块点击“编辑”，字段变为可输入
  3. 输入邮箱 `newuser@example.com`，点击“保存”
  4. 提示“修改成功”，页面显示更新后的邮箱
- 备选/异常流：
  - 邮箱格式非法 → 阻止保存并提示
- 后置条件：联系方式更新
- 验收点：信息展示与保存反馈

## 3. 需求树

### 3.1 功能需求树（F）

- F 用户功能总览
  - F1 用户认证
    - F1.1 注册（表单校验、协议勾选、默认乘客创建）
    - F1.2 登录（账号密码、成功问候语展示、会话）
  - F2 常用乘车人
    - F2.1 查看（列表展示）
    - F2.2 添加（姓名/证件/手机号/优惠类型校验与保存）
    - F2.3 删除（确认框、受限删除策略）
  - F3 车票查询与筛选
    - F3.1 单程查询（城市、日期）
    - F3.2 按车次类型筛选（G/D/K）
    - F3.3 按席别筛选（商务/一等/二等/硬座/硬卧/软卧）
    - F3.4 修改查询条件（并刷新列表）
  - F4 订单
    - F4.1 选择车次并预订（跳转订单页）
    - F4.2 提交订单（乘客勾选、席别选择、待支付）
    - F4.3 支付订单（模拟支付、状态更新）
    - F4.4 订单列表（未完成/未出行）
  - F5 个人信息
    - F5.1 查看个人信息（基本信息与联系方式）
    - F5.2 编辑联系方式（邮箱编辑与保存）
  - F6 初始化与数据
    - F6.1 用户状态清理（`new user`）
    - F6.2 车次数据预置（2025-12-15/16 全量）

### 3.2 非功能需求树（N）

- N 非功能总览
  - N1 安全
    - N1.1 密码散列存储（bcrypt/argon2）
    - N1.2 会话安全（HttpOnly/Secure、CSRF、XSS 防护）
    - N1.3 访问控制（未登录限制）
    - N1.4 操作日志（注册/登录/乘客增删/订单创建与支付）
  - N2 性能
    - N2.1 查询响应 ≤ 2s
    - N2.2 列表/筛选 UI 反馈 ≤ 1s
  - N3 可靠性
    - N3.1 订单事务保障
    - N3.2 支付幂等
  - N4 可用性
    - N4.1 字段级校验与提示
    - N4.2 关键操作确认（删除、支付）
  - N5 兼容与维护
    - N5.1 主流浏览器兼容
    - N5.2 模块化接口、错误码规范

### 3.3 数据需求树（D）

- D 数据总览
  - D1 表结构
    - D1.1 users（username 唯一、id_number 唯一）
    - D1.2 passengers（user_id、id_number 唯一、discount_type）
    - D1.3 trains（train_no、train_type、站点时刻、travel_date、席别与价格映射）
    - D1.4 orders（user_id、train_id、status、金额、时间戳）
    - D1.5 order_items（order_id、passenger_id、seat_class、price）
  - D2 约束与索引
    - D2.1 唯一键与组合唯一（`trains(train_no, travel_date)`）
    - D2.2 常用查询字段索引
  - D3 初始化数据
    - D3.1 2025-12-15（G101/D313/K511/G7001/D5401/G7002）
    - D3.2 2025-12-16（G103/D315/G153/G7003）
  - D4 映射与特殊值
    - D4.1 城市-车站映射（北京/南京/上海）
    - D4.2 到达跨日表示（如 `14:45+1`）

## 4. 测试用例到场景映射（追踪）

- test1-1 注册 → S1 用户注册与登录（注册部分）
- test1-2 登录 → S1 用户注册与登录（登录部分）
- test2-1 查看乘车人 → S2 常用乘车人管理（查看）
- test2-2 添加乘车人 → S2 常用乘车人管理（新增）
- test2-3 删除乘车人 → S2 常用乘车人管理（删除）
- test3-1 查询车票 → S3 车票查询（单程）
- test3-2 筛选车次类型 → S4 车次筛选（类型）
- test3-3 筛选席别 → S4 车次筛选（席别）
- test3-4 修改查询条件 → S4 条件修改与刷新
- test4-1 选择车次 → S5 订单创建（预订）
- test4-2 提交订单 → S5 订单创建（提交）
- test4-3 支付订单 → S6 订单支付（模拟）与列表查看
- test5-1 查看个人信息 → S7 个人信息查看
- test5-2 修改个人信息 → S7 联系方式编辑

## 5. 场景验收清单（摘要）

- S1：注册成功跳转首页；登录后显示“您好, New User”
- S2：列表显示默认乘客；新增“张三”“李四”；删除“张三”后列表无该项
- S3：北京→上海（2025-12-15）结果展示
- S4：类型仅 D 显示动车；席别仅“一等座”过滤；南京→上海条件刷新
- S5：预订进入订单页；勾选“New User”，席别“二等座”；生成“待支付”
- S6：“去支付”后提示成功；状态改“已支付”；“未出行订单”可见
- S7：个人信息可见；邮箱保存后提示“修改成功”且显示更新值

---



