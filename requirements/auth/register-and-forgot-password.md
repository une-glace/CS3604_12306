1. 注册与找回密码模块概述

    1.1 涉及页面与路由
        - 注册页面：/register
        - 找回密码-填写账号：/forgot-password
        - 找回密码-短信验证：/forgot-password/verify
        - 找回密码-重置密码：/forgot-password/reset
        - 找回密码-完成提示：/forgot-password/done

2. 注册页面（/register）

    2.1 页面布局

        2.1.1 顶部品牌与搜索区域
            - 与首页保持一致：
              - 左侧Logo与"中国铁路12306"文字
              - 中间为搜索框与"Q"按钮（当前不触发实际搜索）
              - 右侧为无障碍、敬老版、English、我的12306、登录/注册按钮
        
        2.1.2 导航栏
            - 与首页相同的横向导航条（实现为简化版静态nav）
            - 默认"首页"链接高亮
        
        2.1.3 主体区域
            - 左侧为注册表单区域，宽度固定，白色背景
            - 右侧可预留为帮助说明或广告区域（当前实现中已移除右侧信息区块，仅保留左侧表单）
            - 注册表单顶部通过步骤样式呈现两步流程：
              - 步骤1：填写账户信息
              - 步骤2：手机验证

        2.1.4 页面整体样式与容器
            - 结构来源：`frontend/src/components/Register.tsx` 和 `frontend/src/components/Register.css`（frontend/src/components/Register.css:1-40, 80-120）
            - 根容器 `.register-container`：
              - 背景颜色为白色 `#ffffff`，最小高度 `100vh`
              - 统一使用微软雅黑字体族，保证与 12306 官网接近的视觉效果
            - 顶部专用头部 `.register-header`：
              - 高度约 `80px`，左右内边距 `40px`
              - 左侧为站点 Logo 与“铁路 12306”文字，右侧为静态导航链接与“去登录”按钮
              - 采用浅阴影 `box-shadow: 0 2px 8px rgba(0,0,0,0.1)` 与首页区分
            - 主体容器 `.register-main`：
              - 最大宽度 `1200px`，水平居中 `margin: 40px auto`
              - 使用 `display: flex` 水平排布，左侧为表单容器 `.register-form-container`
            - 表单容器 `.register-form-container`：
              - 边框为蓝色 `1px solid #8bb4ff`，圆角为 `0`（直角）
              - 高度约 `574.5px`，宽度最大 `980px`，背景为白色
              - 顶部无额外标题条，步骤标题通过内部 `<h3>` 实现

    2.2 注册流程步骤控制

        2.2.1 步骤状态
            - currentStep=1：账户信息填写
            - currentStep=2：手机验证码验证与提交注册
            - 用户通过"下一步"、"上一步"按钮在步骤间切换

        2.2.2 步骤指示器UI
            - 样式来源：`frontend/src/components/Register.css` 中 `.step-indicator` 与 `.step*`（frontend/src/components/Register.css:40-104）
            - 布局：
              - 步骤指示器位于表单上方居中区域 `.step-indicator`
              - 使用 `flex` 水平排布 2 个步骤节点，节点间通过浅灰横线连接
            - 步骤节点：
              - 圆形步骤号 `.step-number`：
                - 默认背景为浅灰 `#e8e8e8`，数字颜色为灰色
                - 当前激活步骤背景为主题蓝 `#1890ff`，文字为白色
                - 已完成步骤背景为绿色 `#52c41a`，并在圆内附加白色“✓”标记
              - 步骤标题 `.step-label`：
                - 默认字体 `14px`，颜色 `#666`
                - 激活步骤标题变为蓝色 `#1890ff`，字重略微加粗

        2.2.2 下一步按钮行为
            - 当处于步骤1：
              - 若未勾选服务条款（agreementAccepted=false）且未处于E2E测试模式：
                - 弹出alert："请确定服务条款!"
                - 在复选框下方展示错误："请确定服务条款!"
                - 不允许进入下一步
              - 调用validateCurrentStep，对当前步骤的全部字段进行校验
              - 若无校验错误，则currentStep加1，进入步骤2
            - 当处于步骤2：
              - 不提供进一步步骤，仅用于验证短信验证码和提交注册

        2.2.3 上一步按钮行为
            - 当currentStep>1时，点击"上一步"会使currentStep减1，回到上一步骤

    2.3 步骤1：账户信息填写

        2.3.1 表单字段
            - 用户名（必填）
            - 登录密码（必填）
            - 确认密码（必填）
            - 证件类型（必选，下拉框）
            - 姓名（必填）
            - 证件号码（必填）
            - 优惠（待）类型（乘客类型，必选）
            - 邮箱（选填）
            - 手机号码（必填，带国家区号）
            - 服务条款勾选框（必选）

        2.3.2 用户名字段校验
            - 非空校验：
              - 为空时，不提示错误，但用户名可用性标记清空
            - 长度限制：
              - 小于6字符时提示："用户名长度不能少于6个字符！"
              - 超过30字符时提示："用户名长度不能超过30个字符！"
            - 格式校验：
              - 正则：^[A-Za-z][A-Za-z0-9_]*$
              - 不符合时提示："用户名只能由字母、数字和_组成，须以字母开头！"
            - 后端可用性检查：
              - 调用checkUsernameAvailability接口
              - 若返回available=false：
                - 提示："该用户名已经占用，请重新选择用户名！"
              - 否则在用户名右侧显示"✓"标记

        2.3.3 姓名字段校验
            - 必填，允许字符：
              - 中文、英文字母、"."和空格
            - 显示长度：
              - 中文按2字符计算，英文按1字符计算
              - 有效区间为3-30字符，否则提示："允许输入的字符串在3-30个字符之间！"

        2.3.4 证件号码校验
            - 仅允许字母及数字
            - 当证件类型为中国居民身份证（idType='1'）时：
              - 长度必须为18位
              - 格式必须匹配：^\d{17}[0-9Xx]$
              - 不符合时统一提示："请正确输入18位证件号码！"

        2.3.5 登录密码与确认密码
            - 登录密码：
              - 最少6个字符
              - 只能包含字母、数字和下划线
              - 至少包含上述三类中的两类
              - 不满足时提示："格式错误，必须且只能包含字母、数字和下划线中的两种或两种以上！"或"密码长度不能少于6个字符！"
              - 根据强度显示1~3格强度条（弱、中、强）
            - 确认密码：
              - 为空时提示："请再次输入登录密码"
              - 与登录密码不一致时提示："确认密码与密码不同！"

        2.3.6 手机号码及邮箱校验
            - 手机号码：
              - 仅支持11位数字
              - 不符合时提示："您输入的手机号码不是有效的格式！"
            - 邮箱：
              - 若不为空，则需通过基本邮箱格式校验
              - 不符合时提示："请正确填写邮箱地址"

        2.3.7 服务条款勾选
            - 未勾选时，若用户点击"下一步"：
              - 弹出alert："请确定服务条款!"
              - 在勾选框附近显示错误："请确定服务条款!"

        2.3.8 步骤1整体验证
            - 调用时会综合校验用户名、密码、确认密码、姓名、证件号码、手机号码、邮箱及条款勾选状态
            - 若存在任一错误，则阻止进入下一步并在对应字段下显示错误信息

        2.3.9 步骤1表单布局与样式
            - 布局定义：`frontend/src/components/Register.css` 中 `.register-form-grid` 段（frontend/src/components/Register.css:180-240）
            - 网格布局：
              - 使用 3 列网格：标签列、输入列、提示列
              - 列宽分别为 `150px` / `210px` / 自适应（`1fr`），行间距 `16px`
            - 标签列 `.grid-label`：
              - 文本右对齐，字体大小约 `14px`，颜色 `#333`
              - 必填项前追加红色星号 `.required-star`，颜色 `#f5222d`
            - 输入列 `.grid-input`：
              - 文本输入与下拉框统一高度 `30px`，边框为浅灰 `#d9d9d9`，无圆角（`border-radius: 0`）
              - 焦点态边框变为主题蓝 `#1890ff`，同时出现浅蓝色外发光，提示当前编辑字段
              - 用户名字段右侧预留“用户名可用”绿色勾选图标 `.valid-icon`
              - 密码字段右侧提供显隐切换按钮 `.password-toggle-btn`，采用灰色图标
            - 提示列 `.grid-hint`：
              - 使用橙色或灰色小号字体展示字段使用说明或错误信息，字号 `12px`
            - 协议区 `.agreement-section`：
              - 置于网格底部，背景为浅灰 `#fafafa`，内边距 `20px`，勾选框自定义为蓝色方形边框，选中时填充蓝色并显示白色勾
            - 操作按钮：
              - “下一步”按钮 `.next-btn` 高度约 `30px`，背景为橙色 `#ff9f1a`，悬浮时变为更深橙色 `#ff8c00`
              - 按钮圆角 `8px`，字号 `12px`（注册流程按钮整体偏小、紧凑）

    2.4 步骤2：手机验证码验证

        2.4.1 短信验证码发送
            - 点击"获取验证码"按钮前提：
              - 手机号格式必须合法（11位数字），否则在手机和验证码字段显示"您输入的手机号码不是有效的格式！"
            - 发送逻辑：
              - 调用sendPhoneCode接口，参数包括countryCode与phoneNumber
            - 成功后：
              - 设置verificationCodeSent=true
              - 启动60秒倒计时，每秒更新countdown
              - 将isVerified重置为false
            - 失败时：
              - 在phoneNumber和phoneVerificationCode字段显示"发送验证码失败"或后端返回的错误消息

        2.4.2 验证码输入与校验
            - 若未发送验证码（verificationCodeSent=false）而用户点击"验证"：
              - 提示："请先发送验证码"
            - 若验证码为空或长度不为6：
              - 提示："请输入6位验证码"
            - 调用verifyPhoneCode接口校验：
              - 成功时：
                - 设置isVerified=true
                - 弹出"验证通过"提示
              - 失败时：
                - 设置isVerified=false
                - 在验证码字段显示后端返回的错误或"验证码输入错误，请重新输入"

        2.4.3 步骤2表单布局与样式
            - 验证码输入区域：
              - 布局结构与步骤1保持一致，验证码输入框后跟随“获取验证码”按钮
            - 操作按钮：
              - “完成注册”按钮 `.submit-btn`
              - 基础高度 `48px`（比“下一步”按钮更高），背景色与悬浮态同“下一步”按钮
              - 尺寸显著加宽：最小宽度 `240px`，左右内边距 `60px`，以增强重要操作的视觉权重

        2.4.4 提交注册
            - 点击提交按钮时：
              - 再次调用validateCurrentStep，校验步骤2所需字段（主要为验证码）
              - 校验通过后：
                - 确保用户名满足长度与格式要求（二次防御）
                - 若处于步骤2且isVerified为false：
                  - 自动调用verifyPhoneCode再次校验验证码，失败则阻止提交
            - 注册接口调用：
              - 调用registerUser接口，传入用户名、密码、证件信息、联系方式等字段
              - 成功：
                - 调用login方法自动登录，将用户跳转至"/profile"
                - 弹出"注册成功！"提示
              - 失败：
                - 若后端返回字段级errors：
                  - 映射到表单字段错误
                  - 若已通过验证码且错误中包含用户名已存在提示：
                    - 尝试调用loginUser用相同用户名密码直接登录
                    - 若登录成功，则自动登录并跳转"/profile"
                - 若仅有message：
                  - 同样在"用户名已存在"场景下尝试自动登录
                  - 否则通过alert提示"注册失败，请重试"或具体message

3. 找回密码流程

    3.1 填写账号页面（/forgot-password）

        3.1.1 页面结构
            - 顶部品牌与导航与首页一致
            - 主体为找回密码流程第一步表单，包含：
              - 账号输入（支持用户名或手机号）
              - 图形验证码或提示占位（依据实现简化）
              - 下一步按钮

        3.1.2 行为概述（根据frontend/src/pages/ForgotPasswordPage.tsx推断）
            - 用户输入注册时使用的账号信息
            - 前端进行基础非空与格式校验
            - 成功后跳转到短信验证页面"/forgot-password/verify"，并携带必要上下文（例如手机号脱敏展示）

        3.1.3 页面布局与样式细节
            - 结构与样式来源：`frontend/src/pages/ForgotPasswordPage.tsx` 与 `frontend/src/pages/ForgotPasswordPage.css`（frontend/src/pages/ForgotPasswordPage.css:1-120）
            - 根容器 `.forgot-page`：
              - 背景为浅灰色 `#f5f5f5`，最小高度 `100vh`
              - 与注册页、登录页采用相同头部与导航组件，保证整体一致性
            - 找回方式切换标签 `.fp-tabs`：
              - 宽度 `980px`，高度 `70px`，背景为白色
              - 内含 3 个等宽标签 `.fp-tab`：
                - 左起依次为“人脸找回”“手机找回”“邮箱找回”
                - 当前选中标签 `.fp-tab-active` 背景为浅蓝 `#73c7e9`，文字为白色
                - 未选中标签背景为深蓝 `#2d87c6`
                - 每个标签左侧通过 `::before` 伪元素展示对应图标（人像、手机、信封）
            - 步骤条 `.fp-steps`：
              - 使用一条浅灰色进度线贯穿整个宽度，每个步骤使用圆形节点 `.fp-step-circle` 表示
              - 当前步骤节点填充为深蓝 `#1f6fb4`，文字加粗；后续步骤节点为空心灰色
            - 表单区域 `.fp-core`：
              - 使用白色背景与浅灰边框，内边距 `24px 28px`，整体宽度不超过 `980px`
              - 每行表单项 `.fp-row` 使用 `grid` 布局：
                - 列宽分别为 `140px`（标签）、自适应输入区域、提示列
              - 输入框 `.fp-input` 宽度 `280px`、高度 `32px`，边框为浅灰 `#dcdcdc`
              - 提示文本 `.fp-hint` 使用淡黄色背景，边框 `#ffd597`，提示区域统一高度
            - 操作按钮：
              - “提交”按钮 `.fp-submit` 使用从浅橙到深橙的渐变背景，边框为橙色，文字为白色
              - 按钮尺寸 `120x36px`，位于表单底部居中

    3.2 短信验证页面（/forgot-password/verify）

        3.2.1 页面结构
            - 顶部品牌与导航保持与首页一致
            - 主体展示当前找回密码进度及绑定手机号脱敏信息
            - 表单包含：
              - 短信验证码输入框
              - "获取验证码"按钮（若当前验证流程需要重新发送）
              - 下一步按钮

        3.2.2 行为概述
            - 校验验证码长度与格式
            - 调用后端接口验证验证码是否正确、是否在有效期内
            - 验证通过后跳转至"/forgot-password/reset"

        3.2.3 验证页面布局与样式
            - 样式来源：`frontend/src/pages/ForgotPasswordVerifyPage.css`（frontend/src/pages/ForgotPasswordVerifyPage.css:1-47）
            - 页面容器与标签：
              - 使用与 3.1 同一套 `.forgot-page`、`.fp-container`、`.fp-tabs`、`.fp-steps` 样式
              - 当前步骤高亮在第二个节点（“获取验证码”）
            - 表单行 `.fp-row`：
              - 网格列宽定义为 `220px 1fr auto`，比第一步更宽的标签列，以容纳“请填写手机验证码：”等文本
              - 标签 `.fp-label` 右对齐显示，支持换行，字号 `14px`
            - 验证码输入与按钮：
              - 验证码输入框 `.fp-input.fp-code` 宽度 `220px`
              - “获取验证码”按钮 `.fp-code-btn` 高度 `32px`，背景为深蓝 `#1f6fb4`，带深色描边，文字为白色
              - 手机号码提示中，国家区号文字 `.fp-country-text` 为灰色，手机号部分 `.fp-phone` 使用橙色 `#ff8c00` 突出展示
            - 提示文案：
              - `.fp-hint` 使用较小字号 `12px`，颜色 `#999`
              - `.fp-hint-ok` 采用橙色 `#ff8c00` 提示校验通过

    3.3 重置密码页面（/forgot-password/reset）

        3.3.1 页面结构与字段
            - 顶部品牌与导航保持一致
            - 表单字段：
              - 新密码输入
              - 确认新密码输入
              - 提交按钮

        3.3.2 行为概述
            - 使用与注册页相同的密码规则进行校验：
              - 最少6个字符
              - 字母、数字、下划线，至少包含两种类型
              - 两次输入必须一致
            - 校验通过后调用后端重置密码接口
            - 成功后跳转至"/forgot-password/done"

        3.3.3 重置密码页面UI细节
            - 样式来源：`frontend/src/pages/ForgotPasswordResetPage.css`（frontend/src/pages/ForgotPasswordResetPage.css:1-33）
            - 页面结构：
              - 复用 `.forgot-page`、`.fp-container`、`.fp-tabs`、`.fp-steps` 等整体布局，与步骤一、二保持统一
              - 当前步骤高亮在第三个节点 “设置新密码”
            - 表单布局：
              - 表单行 `.fp-row` 使用 `grid-template-columns: 140px 1fr auto`，第二列为输入框，第三列为提示/错误信息
              - 输入框 `.fp-input` 宽度 `280px`、高度 `32px`，边框 `1px solid #dcdcdc`
              - 提示区域 `.fp-hint` 为淡黄色背景块，错误信息 `.fp-error` 使用红色文字 `#e23a3a`
            - 操作按钮：
              - “完成”按钮 `.fp-submit` 与步骤一提交按钮视觉一致（橙色渐变背景，白色文字）
              - 禁用状态时透明度降低并禁止鼠标指针（`cursor: not-allowed`）

    3.4 完成提示页面（/forgot-password/done）

        3.4.1 显示内容
            - 顶部品牌与导航
            - 中间区域：
              - 使用"/铁路12306-512x512.png"作为品牌Logo
              - 提示重置密码成功的信息
              - 提供返回登录页的链接或按钮

        3.4.2 行为
            - 用户点击"去登录"按钮，跳转到"/login"

        3.4.3 完成页步骤与样式细节
            - 结构与样式来源：`frontend/src/pages/ForgotPasswordDonePage.tsx` 与 `frontend/src/pages/ForgotPasswordDonePage.css`（frontend/src/pages/ForgotPasswordDonePage.css:1-26）
            - 步骤条：
              - 四个步骤节点全部显示，第四个节点为激活状态并在圆形中展示白色“✓”
              - 步骤文字颜色为深蓝 `#1f6fb4`，并加粗
            - 成功提示框 `.fp-success-box`：
              - 使用橙色边框 `#ff8c00` 与白色背景
              - 提示文字 `.fp-success-text` 为橙色 `#ff8c00`，字号 `14px`
              - 右侧“登录系统”按钮 `.fp-login-link` 采用蓝色文本并带下划线，样式类似链接
            - 辅助提示 `.fp-extra`：
              - 位于成功提示下方居中展示，文字为灰色 `#666`，字号 `12px`
              - 链接 `.fp-extra-link` 使用蓝色文本并带下划线，提示用户可尝试邮箱找回

4. 场景示例（注册账号）

    4.1 用户注册成功
        Scenario: 用户完整填写注册信息并通过手机验证
            Given 用户在注册页面
            And 用户填写了符合要求的用户名、密码、证件信息、手机号码与邮箱
            And 用户勾选了服务条款勾选框
            And 用户点击"下一步"进入手机验证步骤
            And 用户点击"获取验证码"并在手机上收到验证码
            And 用户在验证码输入框中输入正确的6位验证码
            When 用户点击"提交注册"按钮
            Then 系统调用注册接口保存用户信息
            And 注册成功后自动登录
            And 页面跳转到个人中心页面"/profile"
