# 12306 像素级复刻项目计划

## 项目目标
创建一个完全复刻 12306 官方网站的 Web 应用，实现像素级的界面还原和完整的订票流程；面向试用与中期验收，强调可运行、可测试与可部署。

## 当前进展摘要
- 后端 API 已完成并稳定：认证、车次、订票、订单与乘客接口（`backend/src/app.js:38-42`）。
- 数据初始化脚本可用：生成车次与未来 30 天座位数据（`backend/src/scripts/seedData.js:374-383`）。
- 前端页面已完成：`HomePage`、`TrainListPage`、`OrderPage`、`OrderDetailPage`、`ProfilePage`（`frontend/src/pages/`）。
- 自动化测试完善：后端集成（Jest）、前端单测（Vitest）、E2E（Playwright）可在本地与 CI 运行。
- CI/CD 已搭建：对任意分支的 `push`/`pull_request` 触发三套测试作业（`\.github/workflows/ci.yml:15-178`）。

## 项目范围

### 包含功能
1. **首页模块**
   - 导航栏
   - 轮播图
   - 快速购票入口
   - 公告信息
   - 底部链接

2. **用户系统**
   - 注册/登录
   - 身份验证
   - 个人中心
   - 常用联系人管理

3. **车票服务**
   - 车票查询
   - 余票查询
   - 时刻表查询
   - 车票预订
   - 订单管理

4. **支付系统**
   - 订单支付
   - 支付状态查询
   - 退票/改签（模拟）

5. **其他服务**
   - 客服中心（演示）
   - 帮助文档
   - 站点查询（演示）

### 不包含功能
- 真实的支付接口
- 真实的铁路生产数据
- 短信验证服务

## 技术架构

### 前端架构
```
React App
├── Components (UI组件)
├── Pages (页面组件)
├── Services (API服务)
├── Contexts (轻量状态)
├── Utils (工具函数)
├── Styles (样式文件)
└── Assets (静态资源)
```

### 后端架构
```
Express API
├── Controllers (控制器)
├── Models (数据模型)
├── Routes (路由)
├── Middleware (中间件)
├── Scripts (数据脚本)
└── Config (配置文件)
```

## 开发阶段（按当前进展更新）

### 第一阶段：基础架构 (1-2周)
- [x] 项目初始化
- [x] 技术栈选择
- [x] 开发环境搭建
- [x] 基础配置文件
- [x] 代码规范配置（ESLint、TypeScript 类型检查）
- [x] CI/CD 流程搭建（GitHub Actions 三作业）

### 第二阶段：UI组件开发 (2-3周)
- [ ] 设计系统建立
- [x] 基础 UI 组件（`Carousel`、`TrainList` 等）
- [x] 布局组件（`HomePage`/`TrainListPage` 等）
- [x] 表单组件（`Login`、`Register`、`BookingForm`）
- [x] 导航组件（`App.tsx` 路由入口、`Footer`）

### 第三阶段：页面开发 (3-4周)
- [x] 首页开发
- [x] 登录/注册页面
- [x] 车票查询页面
- [x] 订票页面
- [x] 个人中心页面
- [x] 订单管理页面

### 第四阶段：后端 API 开发 (2-3周)
- [x] 用户认证 API
- [x] 车次查询 API
- [x] 订票 API
- [x] 订单管理 API
- [x] 支付模拟 API

### 第五阶段：功能集成 (1-2周)
- [x] 前后端联调
- [x] 功能测试（E2E、单测、后端集成）
- [ ] 性能优化（进行中：SQLite WAL、队列与清理任务）
- [ ] 兼容性测试（主流浏览器验证中）

细化任务（进行中）
- 优化订单并发：席位扣减事务化与幂等保护
- 清理任务调度：最小化锁竞争、批量更新（`backend/src/server.js:21-71`）
- API 性能：分页查询与索引优化、热点路由缓存
- 错误兜底：统一错误响应与用户可感知提示

### 第六阶段：部署上线 (1周)
- [ ] 生产环境配置（SQLite/或 MySQL）
- [ ] 服务器部署
- [ ] 域名配置
- [ ] 监控配置

细化任务（待完成）
- Nginx 前端静态与 `/api/v1` 反向代理
- 后端环境变量与 CORS 白名单设置
- 演示环境数据初始化与清理脚本
- 观察指标与日志采集（请求耗时、错误率）

## 关键里程碑

| 里程碑 | 预计完成时间 | 交付物 |
|--------|-------------|--------|
| 项目启动 | 第1周 | 项目架构、开发环境 |
| UI组件库 | 第3周 | 基础组件与布局（进行中） |
| 核心页面 | 第6周 | 主要页面功能（已完成） |
| API服务 | 第8周 | 后端 API 服务（已完成） |
| 功能集成 | 第10周 | 自动化测试与联调（已完成基础） |
| 项目交付 | 第11周 | 部署上线（待完成） |

里程碑细化（新增）
- M3：性能与兼容性验证（完成任务清单 ≥ 80%）
- M4：一键演示部署（README 指南与 Nginx/Compose 验证通过）

## 风险评估（按现状）

### 高风险
1. **UI 复刻精度**：页面与交互细节较多
   - 缓解：组件拆分、对比核验、持续迭代

2. **订票流程复杂度**：多步骤、多角色数据一致性
   - 缓解：端到端测试、订单状态清理与回收逻辑（`backend/src/server.js:21-71`）

### 中风险
1. **性能与并发**：席位扣减与订单并发写入
   - 缓解：SQLite WAL 与 `busy_timeout`（`backend/src/config/database.js:33-38`）

2. **兼容性**：多浏览器/多平台差异
   - 缓解：E2E 覆盖、按需修正样式与路由行为

### 低风险
1. **技术选型**：成熟栈与轻量状态管理
2. **协作流程**：CI 护栏与分支管理

## 质量保证

### 代码质量
- ESLint + TypeScript 类型检查
- 代码审查（PR）与 CI 质量门禁

### 功能质量
- 自动化测试：Jest（后端）、Vitest（前端单测）、Playwright（E2E）
- 目标覆盖：单测与端到端覆盖率 > 80%（阶段目标）

### UI质量
- 像素级对比与交互一致性验证
- 多设备/分辨率核验（进行中）

## 成功标准

1. 功能完整性：实现 12306 核心功能 ≥ 90%
2. UI 还原度：像素级还原度 ≥ 95%
3. 性能指标：关键页面加载时间 < 3 秒（演示环境）
4. 兼容性：主流浏览器近 2 个版本
5. 代码质量：测试覆盖率目标 ≥ 80%，无严重问题

## 运行与验收
- 快速运行与部署：见 `README.md`
- 测试与运行细节：见 `docs/测试与运行指南.md`

## 资源需求

### 人力资源
- 前端开发工程师：1 人
- 后端开发工程师：1 人
- UI/UX 设计：1 人（兼职）
- 测试工程师：1 人（兼职）

### 技术资源
- 开发服务器与数据库服务
- 代码仓库与 CI 平台
- 演示部署环境

## 后续计划

1. 功能扩展：更多 12306 细分流程
2. 移动端适配：响应式与触控优化
3. 性能优化：数据缓存与异步化
4. 用户体验：交互细节与可用性改进
5. 持续维护：跟随 12306 官网节奏更新

---

**项目负责人**: TraeAI  
**创建时间**: 2025年  
**最后更新**: 2025年